{% extends 'base.html' %}

{% block title %}Transfer Siswa - Admin{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #008dd1;
        --secondary-color: #fee600;
        --accent-color: #0056b3;
        --light-yellow: #fffbeb;
        --light-blue: #f0f9ff;
        --dark-blue: #004085;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900 flex items-center">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3" style="background: var(--primary-color);">
                            <i class="fas fa-exchange-alt text-white"></i>
                        </div>
                        Transfer Siswa
                    </h1>
                    <p class="text-gray-600 mt-1">Pindahkan siswa antar eskul dengan konversi absensi</p>
                </div>
                <div class="flex space-x-3">
                    <a href="{% url 'admin_manage_students' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Kembali ke Kelola Siswa
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Info Card -->
        <div class="rounded-xl p-6 mb-8" style="background: var(--light-blue); border-left: 4px solid var(--primary-color);">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-lg" style="color: var(--primary-color);"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Informasi Transfer Siswa</h3>
                    <p class="text-sm text-gray-700 mb-3">
                        <strong>Proses transfer siswa:</strong>
                    </p>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>• Siswa akan dipindah dari eskul lama ke eskul baru</li>
                        <li>• Absensi yang ada akan dikonversi ke pertemuan dengan tanggal yang sama</li>
                        <li>• Data siswa tetap aman dan tidak hilang</li>
                        <li>• Pelatih lama dan baru akan mendapat notifikasi</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Transfer Form -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200" style="background: var(--light-blue);">
                <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-user-edit mr-2" style="color: var(--primary-color);"></i>
                    Form Transfer Siswa
                </h2>
                <p class="text-sm text-gray-600 mt-1">Pilih siswa dan eskul tujuan untuk memulai proses transfer</p>
            </div>

            <div class="p-6">

                <form method="post" class="space-y-6">
                    {% csrf_token %}

                    <!-- Pilih Siswa -->
                    <div>
                        <label for="siswa_id" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user mr-1" style="color: var(--primary-color);"></i>
                            Pilih Siswa <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <select name="siswa_id" id="siswa_id" required
                                    class="w-full px-4 py-3 pl-10 border border-gray-200 rounded-lg focus:ring-2 focus:ring-offset-2 transition-all duration-200 appearance-none bg-white"
                                    style="focus:ring-color: var(--primary-color); focus:border-color: var(--primary-color);">
                                <option value="">-- Pilih Siswa --</option>
                                {% for siswa in siswa_list %}
                                <option value="{{ siswa.id }}" data-eskul="{{ siswa.eskul.id }}">
                                    {{ siswa.nama_siswa }} - {{ siswa.kelas }} ({{ siswa.eskul.nama_eskul }})
                                </option>
                                {% endfor %}
                            </select>
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-users text-gray-400"></i>
                            </div>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-chevron-down text-gray-400"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Pilih Eskul Tujuan -->
                    <div>
                        <label for="eskul_tujuan_id" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-graduation-cap mr-1" style="color: var(--primary-color);"></i>
                            Pilih Eskul Tujuan <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <select name="eskul_tujuan_id" id="eskul_tujuan_id" required
                                    class="w-full px-4 py-3 pl-10 border border-gray-200 rounded-lg focus:ring-2 focus:ring-offset-2 transition-all duration-200 appearance-none bg-white"
                                    style="focus:ring-color: var(--primary-color); focus:border-color: var(--primary-color);">
                                <option value="">-- Pilih Eskul Tujuan --</option>
                                {% for eskul in eskul_list %}
                                <option value="{{ eskul.id }}">
                                    {{ eskul.nama_eskul }} - {{ eskul.pelatih.nama_lengkap }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-tasks text-gray-400"></i>
                            </div>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-chevron-down text-gray-400"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Info -->
                    <div id="preview-info" class="hidden">
                        <div class="p-4 rounded-lg border-l-4" id="preview-container">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i id="preview-icon" class="fas fa-exclamation-triangle text-lg"></i>
                                </div>
                                <div class="ml-3">
                                    <h4 class="text-sm font-semibold mb-1" id="preview-title">Preview Transfer</h4>
                                    <p class="text-sm" id="preview-text">
                                        <!-- Preview text will be inserted here -->
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-4">
                        <a href="{% url 'admin_manage_students' %}"
                           class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium">
                            <i class="fas fa-times mr-2"></i>
                            Batal
                        </a>
                        <button type="submit"
                                class="inline-flex items-center justify-center px-6 py-3 text-white rounded-lg font-medium transition-all duration-200 text-sm"
                                style="background: var(--primary-color);"
                                onmouseover="this.style.background='var(--accent-color)'"
                                onmouseout="this.style.background='var(--primary-color)'">
                            <i class="fas fa-eye mr-2"></i>
                            Preview Transfer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const siswaSelect = document.getElementById('siswa_id');
    const eskulSelect = document.getElementById('eskul_tujuan_id');
    const previewInfo = document.getElementById('preview-info');
    const previewText = document.getElementById('preview-text');

    function updatePreview() {
        const selectedSiswa = siswaSelect.options[siswaSelect.selectedIndex];
        const selectedEskul = eskulSelect.options[eskulSelect.selectedIndex];

        if (siswaSelect.value && eskulSelect.value) {
            const eskulLama = selectedSiswa.textContent.match(/\(([^)]+)\)/)[1];
            const eskulBaru = selectedEskul.textContent;

            const previewContainer = document.getElementById('preview-container');
            const previewIcon = document.getElementById('preview-icon');
            const previewTitle = document.getElementById('preview-title');

            if (eskulLama === eskulBaru.split(' - ')[0]) {
                previewInfo.classList.remove('hidden');
                previewContainer.className = 'p-4 rounded-lg border-l-4 bg-red-50 border-red-400';
                previewIcon.className = 'fas fa-times-circle text-lg text-red-500';
                previewTitle.textContent = 'Transfer Tidak Valid';
                previewTitle.className = 'text-sm font-semibold mb-1 text-red-800';
                previewText.textContent = `Siswa sudah berada di eskul ${eskulLama}. Pilih eskul yang berbeda.`;
                previewText.className = 'text-sm text-red-700';
            } else {
                previewInfo.classList.remove('hidden');
                previewContainer.className = 'p-4 rounded-lg border-l-4 bg-green-50 border-green-400';
                previewIcon.className = 'fas fa-check-circle text-lg text-green-500';
                previewTitle.textContent = 'Preview Transfer';
                previewTitle.className = 'text-sm font-semibold mb-1 text-green-800';
                previewText.textContent = `${selectedSiswa.textContent.split(' (')[0]} akan dipindah dari ${eskulLama} ke ${eskulBaru.split(' - ')[0]}`;
                previewText.className = 'text-sm text-green-700';
            }
        } else {
            previewInfo.classList.add('hidden');
        }
    }

    // Hide eskul tujuan yang sama dengan eskul siswa
    siswaSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const siswaEskulId = selectedOption.getAttribute('data-eskul');

        // Reset eskul select
        eskulSelect.value = '';

        // Enable/disable options
        Array.from(eskulSelect.options).forEach(option => {
            if (option.value && option.value === siswaEskulId) {
                option.disabled = true;
                option.textContent = option.textContent + ' (Saat Ini)';
            } else {
                option.disabled = false;
                option.textContent = option.textContent.replace(' (Saat Ini)', '');
            }
        });

        updatePreview();
    });

    eskulSelect.addEventListener('change', updatePreview);
});
</script>
{% endblock %}